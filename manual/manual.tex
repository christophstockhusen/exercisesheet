\documentclass[a4paper,fleqn,9pt]{report}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}

% \usepackage{DejaVuSerif}
% \usepackage{DejaVuSans}
% \usepackage{DejaVuSansMono}

\usepackage{lmodern}

\let\sffamily=\rmfamily

\usepackage{microtype}

\usepackage[dvipsnames]{xcolor}
\colorlet{maincolor}{BurntOrange!70!black}

\usepackage[english]{babel}

\usepackage[
  a4paper,
  hmargin={2.5cm,2.5cm},
  vmargin={3cm,3.5cm}
    ]{geometry}

\usepackage{amsmath}

\usepackage{enumitem}
\setlist{nolistsep}
\setitemize{label={--}}

\usepackage{listings}
\lstset{
    basicstyle=\ttfamily\small,
    keywordstyle=\color{maincolor},
    language=[LaTeX]TeX,
    frame=lines,
    framerule=1pt,
    rulesep=2pt,
    backgroundcolor=\color{maincolor!15},
    rulecolor=\color{maincolor!70},
    morekeywords={
      sheet,
      exercise,
      subexercise,
      title,
      deadline,
      number,
      label,
      credits,
      exerciselabel,
      exercisesheet,
      student,
      instructor,
      solution,
      nosolution,
      narrow,
      nonarrow,
      narrowfactor,
      maketitle,
      tableofcontents,
      lecture,
      lecturer,
      semester,
      colorlet,
      sffamily,
      rmfamily
    },
    otherkeywords={a4paper}
  }

\lstMakeShortInline[basicstyle=\normalsize\ttfamily]|

\def\exercisesheet{{exercisesheet}}

\usepackage{titlesec}
\titleformat{\chapter}[display]{\raggedright\sffamily\bfseries\huge}{Chapter~\thechapter}{1ex}{}
\titleformat{\section}[display]{\raggedright\sffamily\bfseries\large}{Section~\thesection}{1ex}{}
\titleformat{\subsection}[display]{\raggedright\sffamily\bfseries}{Subsection~\thesubsection}{1ex}{}

\usepackage{blindtext}

\def\documentoption#1#2#3{%
  \begin{list}{}{%
    \rightmargin=2em
    \leftmargin=2em
    \listparindent=\parindent
    \parsep=\parskip
  }%
  \item
  \hskip-\leftmargin
  \hbox to \linewidth{%
    \hbox to \textwidth{%
      \lstinline[basicstyle=\normalsize\ttfamily]{#1}%
      \lstinline[basicstyle=\normalsize\ttfamily]{=\{}%
      \textit{#2}%
      \lstinline[basicstyle=\normalsize\ttfamily]{\}}%
      \hfill
      \lstinline{#3}%
    }%
    \hss
  }%
  \par\smallskip\noindent\ignorespaces
}
\def\enddocumentoption{\end{list}}

\def\syntax{%
  \begin{list}{}{%
    \leftmargin=\parindent
    \rightmargin=0em
    \listparindent=\parindent
    \parsep=\parskip
    \itemindent=-\leftmargin
  }
  \item
}
\def\endsyntax{\end{list}}

\def\syntaxdefaultarg#1{\hfill\texttt{#1}\par\smallskip\noindent\ignorespaces}
\def\metaargument#1{\textit{#1}}

\def\myempty{}
\def\ifempty#1#2#3{%
  \def\tmpempty{#1}%
  \ifx\tmpempty\myempty
    \expandafter\firstoftwo
  \else
    \expandafter\secondoftwo
  \fi
  {#2}{#3}}

\def\firstoftwo#1#2{#1}
\def\secondoftwo#1#2{#2}

\usepackage[
  pdfborder={0 0 0},
    ]{hyperref}

\begin{document}

\begin{titlepage}
  \null \vskip .2\textheight
  \fontsize{36}{40}\selectfont
  \sffamily\bfseries Reference Manual \par
  of the \exercisesheet{} Class \par \bigskip \bigskip
  \Large \color{maincolor}%
  Christoph Stockhusen \par \bigskip
  \today \vskip .1\textheight
\end{titlepage}

\begin{abstract}
  The \exercisesheet{} class provides a convenient way to produce
  hiqh-quality exercise sheets for both students and instructors. This
  is the official reference manual. It contains tutorials for students
  and instructors that explain the first steps in using this class.
  Moreover, a complete list of the commands defined by the
  \exercisesheet{} class is contained.
\end{abstract}

\tableofcontents

\chapter{Introduction and Tutorials for Students and Instructors}

My aim with programming the \exercisesheet{} class is to provide both
students and teachers a \LaTeX{} class for easily typesetting
exercisesheets and their solutions. Therefore, the following two
sections contain tutorials for students as well as teachers for using
the \exercisesheet{} class. Files with the complete code of the
templates are available with this package; You can download them from
\url{http://exercisesheet.googlecode.com}. As the teachers tutorial
builds upon the students tutorial, I highly recommend to first read
the students tutorial.

\section{A Tutorial for the Student Lia}

This semester, Lia, student of Computer Science, plans to typeset the
solutions of all the exercise sheets with \LaTeX{}. In the last
semesters she wrote her solutions per hand which had several
drawbacks:
\begin{itemize}
  \item Often her first solutions to exercises contained little errors
    that she had to correct. Very small errors were easy to correct,
    but many times she had to insert some sentences or formulas into
    her solution with the result that Lia had to write several pages
    of solutions again.
  \item One week 
  \item \ldots
\end{itemize}
Lia thinks that she can overcome these drawbacks by writing her
solutions at her computer with \LaTeX. As this will be Lia's first
experience with \LaTeX{} she asks her tutor Bo for help. He feels
happy about Lia's plans because he thinks that this will be a good
preparation for her bachelor's thesis. Bo recommends the
\exercisesheet{} class that he often used for typesetting his
solutions for exercise sheets.

At home from university, Lia downloads and installs a common \LaTeX{}
distribution and starts to create a simple template file that she
plans to use for her next exercise sheets. She creates a file 
|template_student.tex| and opens it in her
favorite text editor \emph{GVim}. She sets up her file with the
following lines.
\lstinputlisting[linerange={1-9}]{template_student.tex}
Lia passes the |a4paper| to the
\lstinline|\documentclass{exercisesheet}| command because she wants
the paper layout to be \textsc{din}~A~4. Moreover, she uses the
|student| option which makes the class print its titles in
an appropriate manner for submitting the solutions to her instructor.
Then Lia specifies the name of the lecture, the name of the lecturer,
the semester, and her name. Within these commands the makes use of the
tilde~|~| in order to suppress undesirable line breaks, like
Donald Knuth recommended in the \TeX{}book.

With this setup Lia is now ready to typeset her first exercise sheet.
Hence, she types in the following.
\lstinputlisting[linerange={21-22,27-29,50-51}]{template_student.tex}
Lia uses the \lstinline|\sheet| command to start a new exercise sheet.
The command requires no argument but accepts an optional list of
key-value pairs that affect the appearance of the sheet. She decides
to use the keys |title| to set a temporary title.

That was easy! At this point nothing can stop her typesetting her
first solution. Lia continues typing. She uses the following lines to
typeset a solution for an exercise that is split into two
subexercises.

\lstinputlisting[linerange={31-46}]{template_student.tex}

Lia is really happy about the simplicity of the \exercisesheet{}
class. She notices that the can typeset multiple exercise sheets
within a single \LaTeX{} document by simply using the
|\sheet| macro repeatedly. Therefore, she asks herself
whether the \exercisesheet{} class is capable of typesetting a
title page and a table of contents. She tries whether the following
standard \LaTeX{} macros will work.

\lstinputlisting[linerange={23-23,25-25}]{template_student.tex}

After two runs a table of contents appears in her document that lists
the exercise sheets and the exercises to her complete satisfaction.
But now, as she has compiled her document taken a look at the produced
\textsc{pdf} file, she is not very happy with the default fonts of
\LaTeX{}. She decides to use some other fonts and bring more color
into her sheets. Therefore, she loads the |xcolor| package,
defines a nice orange as her base color, sets the serif font to
Palatino and the sans-serif font to Biolinum. Furthermore, she
redefines the fonts of the sheet title and the subtitle. This also
affects the title page and now Lia is really happy with her result.
\lstinputlisting[linerange={11-19}]{template_student.tex}

Altogether, Lia has written the following template code.

\lstinputlisting{template_student.tex}


\section{A Tutorial for the Instructor Prof.~Foo~Bar}

When Prof.~Foo~Bar sees Lia's solutions he is highly impressed. Not
only are Lia's solutions almost perfectly correct, also it's
appearance is very beautiful in comparison with his exercise sheets.
Hence, he asks Lia whether he may use her template to type his
exercise sheets. Lia, really happy for this to happen, tells
Prof.~Foo~Bar about the \exercisesheet{} class and emails her template
to him. Foo immediately opens the template file and starts customizing
the template for his requirements.

First, he changes the call of the document class as he is not a
student anymore and mainly doesn't want his exercise sheets look like
a sheet of solutions. Moreover, he adds the |nosolution|
option. This option makes the sample solutions that Foo types
disappear. This way he can type down the solutions to his exercises
and easily make them disappear if he wants to create the \textsc{pdf}
version of the sheet for the website. Later on, he can use the
|solution| option if he wants the previously invisible
solutions to reappear.

\lstinputlisting[linerange={1-3,5-6}]{template_instructor.tex}

With this options, Foo is now able to include the sample solutions in
a convenient way directly in his \LaTeX{} file without annoying
commenting in and out. As Foo often places the sample solutions to the
exercises at the very end of the sheet and not directly behind the
exercises, he uses the build-in referencing mechanism to link the
exercises with it's sample solutions. Moreover, he uses the
|credits| option to assign credit points to his exercises.
Therefore, he augments his template as follows.

\lstinputlisting[linerange={33-57}]{template_instructor.tex}

When Foo typesets his document (which takes two runs to create the
table of contents and get the references right) he notices that his
exercise sheet has a very large margin at the right. He immediately
understands that this must be intentional by the author of the
\exercisesheet{} class to provide space for detailed corrections on
the solutions of the students. He shortly thinks about adding the
|nonarrow| option to the call of the document class which
would remove the additional margin on the right, but then he thinks
about just changing the width of the right margin as a little space
for the students to take notes might be very useful. So the uses the
|narrowfactor| option on the call of the document class
which accepts values from $0$ to $1$ in order to set the amount of the
text width taken by the class as additional margin. As the default
value is |.7|, Foo changes the document-class call as
follows.

\lstinputlisting[linerange={1-6}]{template_instructor.tex}

As last, Foo changes the appearance of his exercise sheets by also
changing the fonts (he doesn't want his sheets to look like Lia's). He
decides to switch everything to Bitstream's \emph{Charter} and
furthermore substitutes Lia's orange by a dark blue. Altogether Foo is
really satisfied by his work and starts thinking about easy and
difficult exercises. His template file now looks as follows.

\lstinputlisting{template_instructor.tex}


\chapter{Using the \exercisesheet{} Class}

This chapter contains a brief introduction into the underlying
concepts and design principles of the \exercisesheet{} class.


\section{A Note on Using the Document Class Options}

Most of the parameters of the document class can be changed within the
call of the document class. Every option works with a key-value
mechanism, that is, every parameter may be set like in the following
example.
\begin{lstlisting}
\documentclass[
  narrowfactor=.7,
  solution=true
    ]{exercisesheet}
\end{lstlisting}
Options that take Boolean values may be used without a value which
results in setting the option to true. Therefore, the above example
is equivalent to the following example.
\begin{lstlisting}
\documentclass[
  narrowfactor=.7,
  solution
    ]{exercisesheet}
\end{lstlisting}


\section{Creating Sheets and Configuring their Appearance}

To typeset a new exercise sheet the |\sheet| command must be used.
This section provides all information related to the this central
command.

\begin{syntax}
  |\sheet[|\metaargument{key-value-list}|]| \syntaxdefaultarg{}
  The |\sheet| command starts a new exercise sheet. For this, is ships
  out all remaining floats, starts a new page and prints the heading
  of the exercise sheet. Depending on the current mode, the appearance
  of the title is adjusted. For more details on configuring the
  appearance see below in this section.

  The |\sheet| command requires no argument. However, you can pass
  optional arguments as a key-value-list to it. The following keys are
  provided:
  \begin{syntax}
    |deadline={|\metaargument{string}|}| \syntaxdefaultarg{}
    Sets the deadline of the sheet. For example, use 
    |deadline={1.~November~2011}|. Note the |~| that prevents line
    breaking.
  \end{syntax}
  \begin{syntax}
    |label={|\metaargument{string}|}| \syntaxdefaultarg{}
    By using the label option the exercise can be referenced later on
    with the |\ref| command or by the |solution| environment.
  \end{syntax}
  \begin{syntax}
    |number={|\metaargument{a natural number}|}| \syntaxdefaultarg{}
    Sets the number of the exercise sheet. This is useful, if an
    exercise sheet has been missed by a student, for example. If this
    option is omitted, the number of the current exercise sheet is the
    number of the last sheet plus one or one if it is the first sheet.
  \end{syntax}
  \begin{syntax}
    |title={|\metaargument{string}|}| \syntaxdefaultarg{}
    Sets the title of the sheet. For example, use 
    |title={Basics on Turing Machines}| if that's what the exercises
    on the sheet are about.
  \end{syntax}
\end{syntax}

Students (as well as instructors) have to place a lot of information
on their exercise sheets, for example, Students typically have to
place their name, their matriculation number, the name of the
corresponding lecture, the number of the current exercise sheet, and a
lot more. The \exercisesheet{} class is provided with a bunch of
macros to typeset all these information on the sheets.

\begin{syntax}
  |\lecture{|\metaargument{string}|}| \syntaxdefaultarg{}
  This sets the name of the lecture. For example, use
  |\lecture{Computational Complexity}| if the lecture is named
  \emph{Computational Complexity}.
\end{syntax}

\begin{syntax}
  |\lecturer{|\metaargument{string}|}| \syntaxdefaultarg{}
  This sets the name of the lecturer. Prof.~Foo~Bar would use
  |\lecturer{Prof.~Foo~Bar}| for his exercise sheets. Note the |~|
  to prevent unintended line breaking.
\end{syntax}

\begin{syntax}
  |\semester{|\metaargument{string}|}| \syntaxdefaultarg{}
  Sets the current semester. For example, use 
  |\semester{Summer~Semester~2011}|. Note the |~| to prevent
  unintended line breaking.
\end{syntax}

\begin{syntax}
  |\student{|\metaargument{string}|}| \syntaxdefaultarg{}
  This sets the name of the student that has worked out the solutions
  on the sheet. A list of names can be passed as an argument to this
  macro if a group of students has been working on the sheets. For
  example, use
  |\student{Justus~Jonas, Peter~Shaw, and Bob~Andrews}|. Analogous you
  can add matriculation numbers behind the names. Note the |~| that
  prevents line breaking.
\end{syntax}

\noindent\emph{Explain how the titles can be changed\ldots}

\section{Exercises and Subexercises}

The \exercisesheet{} class supports two sectioning commands for
structuring exercises: The |\exercise| command and the |\subexercise|
command.

\begin{syntax}
  |\exercise[|\metaargument{key-value-list}|]| \syntaxdefaultarg{}
  The |\exercise| command starts a new exercise. This command needs no
  argument, but can be provided with a key-value-list to change the
  appearance of the exercise title. The following list may also be
  used for the |\subexercise| command.
  \begin{syntax}
    |credits={|\metaargument{a natural number}|}| \syntaxdefaultarg{}
    This sets the credits points that can be achieved by successfully
    solving this exercise.
  \end{syntax}
  \begin{syntax}
    |label={|\metaargument{string}|}| \syntaxdefaultarg{}
    By using the label option the exercise can be referenced later on
    with the |\ref| command or by the |solution| environment.
  \end{syntax}
  \begin{syntax}
    |title={|\metaargument{string}|}| \syntaxdefaultarg{}
    This sets the title for the exercise.
  \end{syntax}
\end{syntax}

\begin{syntax}
  |\subexercise[|\metaargument{key-value-list}|]| \syntaxdefaultarg{}
  This command is intended for structuring exercises and takes the
  same arguments as the |\exercise| command.
\end{syntax}

\section{Solutions}

Solutions can be typeset with the \exercisesheet{} class in two ways:
First, in the |student| mode directly after an |\exercise| command,
and second, in the |instructor| mode within the |solution|
environment. Of course, the |solution| environment may also be used in
the |student| mode if the text of the exercise shall also be presented
on the sheet. However, in this section the |solution| environment is
explained.

\begin{syntax}
  |\begin{solution}[|\metaargument{key-value-list}|]|\par
  \hskip-\leftmargin\metaargument{solution text}\par\noindent
  \hskip-\leftmargin|\end{solution}|
  \syntaxdefaultarg{}
  \ldots
\end{syntax}



\begin{documentoption}{nosolution}{boolean}{false}
  The |nosolution| option turns off the typesetting of
  solutions that are typed within the |solution|
  environment.
\end{documentoption}

\begin{documentoption}{solution}{boolean}{true}
  The |solution| option turns on the typesetting of
  solutions that are typed within the |solution|
  environment.
\end{documentoption}


\section{Wide and Narrow Page Layout}

Up to now, the \exercisesheet{} class supports two modes: The
\emph{student mode} and the \emph{instructor mode}. While the
instructor mode hasn't any notable impact on the page layout, the
student mode has: It switches the width of the page dynamically
according to the content currently typeset. While all the titles (that
is sheet titles, exercise titles, subexercise titles, and so on) are
typeset using the full text width, the remaining content uses only a
fraction of the text width. This allows the correcting tutors to write
down detailed comments on the students solution. The amount of space
used for typesetting the solutions can be set by the
|narrowfactor| option when loading the document class. The
additional margin then equals 
\begin{equation*}
  (1 - \text{narrow factor}) \cdot \text{text width}.
\end{equation*}
Hence, |narrowfactor| takes arguments from $0$ to $1$, the default
value is~$.7$. The option |nonarrow| removes any additional margin.
The following list contains all document class options that are
related to the dynamic-page-layout mechanism of the \exercisesheet{}
class.

\begin{documentoption}{instructor}{boolean}{false}
  This option deactivates the dynamic page layout and adjusts the
  titles.
\end{documentoption}

\begin{documentoption}{narrow}{boolean}{true}
  The |narrow| option activates the additional margin on the
  right hand side of the page that is intended for correction
  proofreaders marks. 
\end{documentoption}

\begin{documentoption}{narrowfactor}{decimal value from 0 to 1}{.7}
  The |narrowfactor| parameter is relative proportion of the
  textwidth that is used by \TeX{}/\LaTeX{} for typesetting exercises
  and solutions. Hence, it takes values from $0$ to $1$.
\end{documentoption}

\begin{documentoption}{nonarrow}{boolean}{false}
  The |nonarrow| option removes the additional margin on the
  right hand side of the page that is intended for correction
  proofreaders marks. 
\end{documentoption}

\begin{documentoption}{student}{boolean}{true}
  This option activates the dynamic page layout and adjusts the
  |titles|. 
\end{documentoption}

\end{document}
